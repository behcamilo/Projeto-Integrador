<div class="booking-container">
    <div class="calendar-panel">

        <header class="calendar-header">
            <button (click)="changeMonth(-1)" class="nav-button">&#10094;</button>
            <h4 class="current-month">{{ currentMonthYear | titlecase }}</h4>
            <button (click)="changeMonth(1)" class="nav-button">&#10095;</button>
        </header>

        <div class="day-names">
            <span>Dom</span>
            <span>Seg</span>
            <span>Ter</span>
            <span>Qua</span>
            <span>Qui</span>
            <span>Sex</span>
            <span>Sab</span>
        </div>

        <div class="days-grid">
            <ng-container *ngFor="let day of daysOfMonth">

                <button
                    *ngIf="day; else emptyCell"
                    class="day-cell"
                    [class.selected]="isDaySelected(day)"
                    [class.has-appointments]="hasAppointments(day)"
                    (click)="selectDay(day)"
                >
                    {{ day.getDate() }}
                </button>

                <ng-template #emptyCell>
                    <span class="day-cell empty"></span>
                </ng-template>
            </ng-container>
        </div>

    </div>

    <div class="hours-panel">
        <div class="hours-grid">
            <div
                *ngFor="let horario of horariosDisponiveis"
                class="time-slot"
                [class.status-disponivel]="horario.status === 'disponivel'"
                [class.status-reservado]="horario.status === 'reservado'"
                [class.status-ocupado]="horario.status === 'ocupado'"
                (click)="openBookingForm(horario)"
            >
                <span class="slot-time">{{ horario.hora_inicio | slice:0:5 }}</span>
                <span class="slot-status">
                    {{ horario.status | titlecase }}
                </span>
            </div>
        </div>

        <p *ngIf="horariosDisponiveis.length === 0 && selectedDate">
            Não há horários disponíveis ou definidos para este dia.
        </p>
    </div>
</div>

<div *ngIf="showBookingForm" class="booking-modal-overlay">
    <div class="booking-modal-content">

        <h4>Agendar Horário: {{ selectedHorario?.hora_inicio | slice:0:5 }}</h4>

        <div *ngIf="erroDeConflito" class="error-message api-error">
            {{ erroDeConflito }}
        </div>

        <form [formGroup]="bookingForm" (ngSubmit)="onSubmitBooking()">
            <div class="form-group">
                <label for="userName">Nome do Usuário:</label>
                <input
                    id="userName"
                    type="text"
                    formControlName="userName"
                    placeholder="Digite o nome do usuário"
                    required
                >
                <div *ngIf="bookingForm.get('userName')?.invalid && bookingForm.get('userName')?.touched" class="error-message">
                    O nome do usuário é obrigatório.
                </div>
            </div>

            <div class="form-group">
                <label for="reservationType">Mudar Status para:</label>
                <select id="reservationType" formControlName="reservationType" required>
                    <option value="disponivel">Disponivel</option>
                    <option value="reservado">Reserva Prévia</option>
                    <option value="ocupado">Ocupado</option>
                </select>
            </div>

            <div class="modal-actions">
                <button
                    type="submit"
                    [disabled]="bookingForm.invalid"
                    class="confirm-button"
                >
                    Confirmar Agendamento
                </button>
                <button type="button" (click)="closeBookingForm()" class="cancel-button">
                    Cancelar
                </button>
            </div>
        </form>
    </div>
</div>
